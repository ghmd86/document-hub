server:
  port: 8080

spring:
  application:
    name: document-hub-service

  # R2DBC (Reactive Database Configuration)
  r2dbc:
    url: r2dbc:postgresql://localhost:5433/documenthub
    username: postgres
    password: postgres123
    pool:
      initial-size: 10
      max-size: 50
      max-idle-time: 30m
      validation-query: SELECT 1

  # Flyway Configuration (JDBC for migrations)
  flyway:
    enabled: true
    url: jdbc:postgresql://localhost:5433/documenthub
    user: postgres
    password: postgres123
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0

  # Redis Configuration (for caching)
  data:
    redis:
      host: localhost
      port: 6379
      password: # Set if Redis requires authentication
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: -1ms
        shutdown-timeout: 100ms

  # Jackson Configuration
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Logging Configuration
logging:
  level:
    root: INFO
    com.documenthub: DEBUG
    org.springframework.web: DEBUG
    org.springframework.data.r2dbc: DEBUG
    io.r2dbc.postgresql: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Custom Application Configuration
integration:
  customer-service:
    base-url: http://localhost:8081
    timeout: 3000
  account-service:
    base-url: http://localhost:8082
    timeout: 3000
  transaction-service:
    base-url: http://localhost:8083
    timeout: 3000

# Circuit Breaker Configuration
resilience4j:
  circuitbreaker:
    instances:
      customerService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 60s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
      accountService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 60s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
