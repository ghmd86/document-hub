package com.example.droolspoc.rules;

import com.example.droolspoc.model.EnhancedAccountFact;
import com.example.droolspoc.model.CustomerFact;
import com.example.droolspoc.model.DocumentEligibilityResult;

/**
 * Enhanced Eligibility Rules
 *
 * These rules use data from external APIs, including:
 * - cardholderAgreementsTNCCode (from chained API calls)
 * - pricingId (from Arrangements API)
 *
 * This demonstrates how Drools rules can use data fetched from multiple
 * external APIs before rule execution.
 */

// Rule 1: TNC Code-Based Eligibility
rule "Gold TNC Specific Document"
    salience 100
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode == "TNC_GOLD_2024"  // ⭐ From external API
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] Gold TNC Specific Document: TNC=" +
            $account.getCardholderAgreementsTNCCode());
        $result.addEligibleDocument("DOC-TNC-GOLD-2024-BENEFITS");
end

// Rule 2: Platinum TNC Specific Document
rule "Platinum TNC Specific Document"
    salience 95
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode == "TNC_PLATINUM_2024"  // ⭐ From external API
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] Platinum TNC Specific Document: TNC=" +
            $account.getCardholderAgreementsTNCCode());
        $result.addEligibleDocument("DOC-TNC-PLATINUM-2024-BENEFITS");
end

// Rule 3: Pricing ID-Based Eligibility
rule "Premium Pricing Package"
    salience 90
    when
        $account: EnhancedAccountFact(
            pricingId matches "PRICING_PREMIUM_.*"  // ⭐ From Arrangements API
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] Premium Pricing Package: pricingId=" +
            $account.getPricingId());
        $result.addEligibleDocument("DOC-PREMIUM-PRICING-BENEFITS");
end

// Rule 4: Combined TNC Code + Account Balance
rule "High Balance Gold TNC Exclusive"
    salience 85
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode == "TNC_GOLD_2024",  // ⭐ From external API
            balance > 50000                                   // Account data
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] High Balance Gold TNC Exclusive: " +
            "TNC=" + $account.getCardholderAgreementsTNCCode() +
            ", balance=" + $account.getBalance());
        $result.addEligibleDocument("DOC-HIGH-BALANCE-GOLD-EXCLUSIVE");
end

// Rule 5: TNC Code + Customer Tier
rule "VIP Customer with Platinum TNC"
    salience 80
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode == "TNC_PLATINUM_2024"  // ⭐ From external API
        )
        $customer: CustomerFact(
            tier in ("PLATINUM", "BLACK")
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] VIP Customer with Platinum TNC: " +
            "TNC=" + $account.getCardholderAgreementsTNCCode() +
            ", tier=" + $customer.getTier());
        $result.addEligibleDocument("DOC-VIP-PLATINUM-TNC");
end

// Rule 6: Any TNC Code Pattern Matching
rule "2024 TNC Version Documents"
    salience 70
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode matches "TNC_.*_2024"  // ⭐ Pattern matching
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] 2024 TNC Version Documents: TNC=" +
            $account.getCardholderAgreementsTNCCode());
        $result.addEligibleDocument("DOC-2024-TNC-UPDATE");
end

// Rule 7: Pricing ID with State-Specific Logic
rule "California Premium Pricing"
    salience 60
    when
        $account: EnhancedAccountFact(
            pricingId matches "PRICING_PREMIUM_.*",  // ⭐ From Arrangements API
            state == "CA"
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] California Premium Pricing: " +
            "pricingId=" + $account.getPricingId() +
            ", state=" + $account.getState());
        $result.addEligibleDocument("DOC-CA-PREMIUM-DISCLOSURE");
end

// Rule 8: Complex Multi-Source Logic
rule "Ultimate Premium Package"
    salience 50
    when
        $account: EnhancedAccountFact(
            cardholderAgreementsTNCCode matches "TNC_(PLATINUM|BLACK)_.*",  // ⭐ External API
            pricingId matches "PRICING_PREMIUM_.*",                         // ⭐ External API
            balance > 100000,                                                // Account data
            status == "ACTIVE"
        )
        $customer: CustomerFact(
            tier in ("PLATINUM", "BLACK"),
            creditScore >= 800
        )
        $result: DocumentEligibilityResult()
    then
        System.out.println("[RULE FIRED] Ultimate Premium Package: " +
            "TNC=" + $account.getCardholderAgreementsTNCCode() +
            ", pricingId=" + $account.getPricingId() +
            ", balance=" + $account.getBalance() +
            ", tier=" + $customer.getTier());
        $result.addEligibleDocument("DOC-ULTIMATE-PREMIUM-PACKAGE");
end
